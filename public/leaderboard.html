<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   <link rel="preconnect" href="https://fonts.googleapis.com">
   <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
   <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet">
   <title>Dynamic Ranking Grid</title>
   <style>
      :root {
         --grid-gap: 0px;
         --row-height: 36px;
         --last-row-height: 20px;
         --marquee-speed: 6s;
         --text-gap: 10px;
         --transition-duration: 0.5s;
      }

      body {
         font-family: "Roboto", Arial, sans-serif;
         margin: 20px;
         white-space: nowrap;
         overflow: hidden;
         color: white;
      }

      #container {
         position:relative;
         width: 210px;
         height:735px;
         /* height: 800px; */
         overflow: hidden;
         /* border: 1px solid #ccc; */
         border-radius: 10px;
         background-color: rgba(0, 0, 0, 0.8);

         padding: 16px 0;
      }

      .title {
         font-size: 1em;
         margin-bottom: 12px;
         margin-left: 12px;
         color: #b3b3b3;
         font-weight: 200;
      }

      #ranking-grid {
         position: relative;
         /* display: grid;
         grid-template-columns: 37px 93px 70px;
         grid-auto-rows: var(--row-height);
         gap: var(--grid-gap);
         width: 305px; */

      }

      .row {
         display: grid;
         grid-template-columns: 37px 93px 70px;
         position: absolute;
         left: 0;
         right: 0;
         transition: top var(--transition-duration);
         height: var(--row-height);
         overflow: hidden;
      }

      .row.last {
         height: var(--last-row-height);
      }

      .cell {
         display: flex;
         align-items: center;
         justify-content: center;
         /* border: 1px solid #ccc; */
         padding: 0;
         overflow: hidden;
         position: relative;
         height: 22px;
      }

      .cell.name {
         justify-content: flex-start;
         font-weight: 300;
      }

      .marquee {
         display: inline-flex;
         animation: scroll var(--marquee-speed) linear infinite;
      }

      .marquee span {
         padding-right: var(--text-gap);
      }

      @keyframes scroll {
         0% {
            transform: translateX(0%);
         }

         100% {
            transform: translateX(-50%);
         }
      }

      .rank-number {
         font-size: 1em;
         font-weight: 400;
         /* font-weight: bold; */
         /* line-height: 1; */
         z-index: 2;
      }

      .crown {
         position: absolute;
         bottom: 3px;
         width: 24px;
         height: 24px;
         overflow: hidden;
      }

      .crown img {
         width: 72px;
         /* sprite width = 3 crowns * 24px each */
         height: 54px;
         object-fit: fill;
         object-position: 0 0;
      }

      /* top-row: gold at 0px, silver at -24px, bronze at -48px */
      .crown.gold img {
         object-position: 0 0;
      }

      .crown.silver img {
         object-position: -24px 0;
      }

      .crown.bronze img {
         object-position: -48px 0;
      }

      .score {
         font-size: 1.1em;
         font-weight: bold;
         justify-content: left;
         padding-left: 5px;
      }
   </style>
</head>

<body>
   <div id="container">
      <div class="title" for="">Ranking list</div>
      <div id="rankingGrid"></div>
   </div>

   <script>
      // Sprite sheet with 3 crowns side-by-side: gold | silver | bronze
      const crownSrc = '/images/crowns.png'; // Adjust the path as needed

      //array of 20 contenstants
      let player = ["NVX BIN", "NVX L", "NVX DLEE", "NVX SHIN",
         "RDNV CICI", "RDNV LILY", "RDNV CHANEE", "RDNV HANNIE", "RDNV ZELZI", "RDNV WINA",
         "TYHT ĐẠO TIÊN", "TYHT HỒ YÊU", "TYHT BẠCH XÀ", "TYHT CHUỘT TINH",
         "KZN YOUNG D", "KZN CARO", "KZN PUDY", "KZN HISSHIN", "KZN MIKE", "KZN KRYS"
      ];
      //generate data with random scores
      let data = player.map((name, index) => ({
         name: name,
         score: Math.floor(Math.random() * 1000000)
      }));


      function renderGrid() {
         //sort data by score
         data.sort((a, b) => b.score - a.score);
         const grid = document.getElementById('rankingGrid');

         // store old positions
         const oldPositions = {};
         grid.querySelectorAll('.row').forEach(row => {
            const key = row.dataset.name;
            oldPositions[key] = row.getBoundingClientRect().top;
         });

         //clear and recreate rows
         grid.innerHTML = '';
         data.forEach((item, index) => {
            const isLast = index === data.length - 1;
            const row = document.createElement('div');
            row.className = 'row' + (isLast ? ' last' : '');
            row.dataset.name = item.name;
            // cell: rank
            const rankCell = document.createElement('div');
            rankCell.className = 'cell';
            const num = document.createElement('div');
            num.className = 'rank-number';
            num.textContent = index + 1;
            rankCell.appendChild(num);

            if (index < 3) {
               const crown = document.createElement('div');
               crown.className = `crown ${index === 0 ? 'gold' : index === 1 ? 'silver' : 'bronze'}`;
               const img = document.createElement('img');
               img.src = crownSrc;
               img.alt = 'Crown';
               crown.appendChild(img);
               rankCell.appendChild(crown);
            }
            row.appendChild(rankCell);
            // cell: name
            const nameCell = document.createElement('div');
            nameCell.className = 'cell name';
            // if (item.name.length > 10) { const mq = document.createElement('div'); mq.className = 'marquee';['', ''].forEach(_ => { const sp = document.createElement('span'); sp.textContent = item.name; mq.appendChild(sp); }); nameCell.appendChild(mq); } else nameCell.textContent = item.name;
            // row.appendChild(nameCell);
            const text = document.createElement('div');
            text.textContent = item.name;
            nameCell.appendChild(text);
            setTimeout(() => {
               if (text.scrollWidth > nameCell.clientWidth) {
                  // text.className = 'marquee';
                  //empty nameCell
                  nameCell.innerHTML = '';
                  //create marquee
                  const marquee = document.createElement('div'); marquee.className = 'marquee';
                  const span1 = document.createElement('span'); span1.textContent = item.name;
                  const span2 = document.createElement('span'); span2.textContent = item.name;
                  marquee.appendChild(span1);
                  marquee.appendChild(span2);
                  nameCell.appendChild(marquee);
               }
            });
            row.appendChild(nameCell);

            // cell: score
            const scoreCell = document.createElement('div');
            scoreCell.className = 'cell score';
            scoreCell.textContent = item.score.toLocaleString(); // Format with commas
            row.appendChild(scoreCell);


            // position row
            const y = index * parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--row-height'))
               + (isLast ? (index * 0 + 0) : 0);
            row.style.top = (y+50) + 'px';
            grid.appendChild(row);
         });

         grid.querySelectorAll('.row').forEach(row => {
            const key = row.dataset.name;
            if (oldPositions[key] != null) {
               const newY = row.getBoundingClientRect().top;
               const delta = oldPositions[key] - newY;
               row.style.transform = `translateY(${delta}px)`;
               requestAnimationFrame(() => {
                  row.style.transition = `transform var(--transition-duration)`;
                  row.style.transform = 'translateY(0)';
               });
               row.addEventListener('transitionend', () => { row.style.transition = ''; row.style.transform = ''; }, { once: true });
            }
         });

      }

      renderGrid();

      function updateScores(newScores) {
         newScores.forEach(ns => {
            const entry = data.find(d => d.name === ns.name);
            if (entry) entry.score = ns.score;
         });
         renderGrid();
      }

      setInterval(() => {
         const randIndex = Math.floor(Math.random() * data.length);
         data[randIndex].score = Math.floor(Math.random() * 10000);
         renderGrid();
      }, 1000);
   </script>

</body>

</html>
